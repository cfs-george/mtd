<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MTD Prototype</title>
  <link rel="icon" type="image/x-icon" href="images/cfs_logo_dark_short.svg">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
  <style>
    @import url("https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap");

    * { font-family: "Inter", sans-serif; box-sizing: border-box; }
    body {
      margin: 40px auto;
      max-width: 800px;
      background-color: #f5f7fa;
      color: #222;
      transition: background-color 0.3s, color 0.3s;
    }
    header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .dark-mode { background-color: #121212; color: #f0f0f0; }
    button { background: #6CA5AC; border: none; color: white; padding: 8px 14px; border-radius: 6px; cursor: pointer; transition: background 0.3s; }
    button:hover { background: #91e5f0; }
    .section { margin-top: 20px; background: white; padding: 16px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); transition: background-color 0.3s; }
    .dark-mode .section { background: #1e1e1e; }
    input, select { padding: 6px; margin: 6px 0; border: 1px solid #ccc; border-radius: 4px; width: 100%; background: #fff; color: #000; }
    .dark-mode input, .dark-mode select { background: #2a2a2a; color: #fff; border-color: #444; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    .dark-mode th, .dark-mode td { border-color: #444; }
    .summary { font-weight: bold; margin-top: 10px; }
    .tabs { display: flex; border-bottom: 2px solid #ccc; margin-bottom: 20px; flex-wrap: wrap; }
    .tab { padding: 10px 20px; cursor: pointer; border-top-left-radius: 10px; border-top-right-radius: 10px; background: #e9ecef; margin-right: 5px; transition: background 0.2s; }
    .tab:hover { background: #d7dde3; }
    .tab.active { background: white; border-bottom: 2px solid white; font-weight: bold; }
    .dark-mode .tab { background: #2a2a2a; color: #ddd; border-color: #444; }
    .dark-mode .tab.active { background: #1e1e1e; border-bottom: 2px solid #1e1e1e; color: #fff; }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    .dark-mode-toggle { background: none; border: none; font-size: 1.4rem; cursor: pointer; color: inherit; }
    /* VAT checkbox alignment */
    label.checkbox-label { display: flex; align-items: center; gap: 6px; cursor: pointer; }
    .checkbox-label input[type="checkbox"] {
      width: 20px;
      height: 20px;
      cursor: pointer;
      margin-left: 20px;
    }
    /* Mobile styles */
    @media (max-width: 600px) {
      body { margin: 20px; }
      .tabs { flex-direction: column; }
      .tab { margin-bottom: 5px; }
      input, select, button { font-size: 0.9rem; }
      th, td { font-size: 0.85rem; }
    }
  </style>
</head>
<body>
  <header>
    <h1>MTD Prototype</h1>
    <button id="darkModeToggle" class="dark-mode-toggle"><i class="fas fa-moon"></i></button>
  </header>

  <div class="tabs">
    <div class="tab active" onclick="showTab('profile')">Business Profile</div>
    <div class="tab" onclick="showTab('income')">Income</div>
    <div class="tab" onclick="showTab('expenses')">Expenses</div>
    <div class="tab" onclick="showTab('summary')">Summary</div>
  </div>

  <section id="profile" class="section tab-content active">
    <h2>Business Profile</h2>
    <div id="profileDisplay">
      <p><strong>Business Name:</strong> <span id="displayName">Not set</span></p>
      <p><strong>VAT Number:</strong> <span id="displayVAT">Not set</span></p>
      <p><strong>VAT Rate:</strong> <span id="displayVATRate">20%</span></p>
      <p><strong>Business Type:</strong> <span id="displayType">Not set</span></p>
      <p><strong>Accounting Basis:</strong> <span id="displayBasis">Not set</span></p>
      <p><strong>Accounting Period:</strong> <span id="displayPeriod">Not set</span></p>
    </div>
    <form id="profileForm">
      <input type="text" id="businessName" placeholder="Business Name" required />
      <input type="text" id="vatNumber" placeholder="VAT Number" />
      <input type="number" id="vatRate" placeholder="VAT Rate %" min="0" max="100" step="0.01" value="20" />
      <select id="businessType">
        <option value="">Select Business Type</option>
        <option>Sole Trader</option>
        <option>Landlord</option>
        <option>Limited Company</option>
        <option>Partnership</option>
      </select>
      <select id="accountingBasis">
        <option value="">Select Accounting Basis</option>
        <option>Cash</option>
        <option>Accrual</option>
      </select>
      <input type="text" id="accountingPeriod" placeholder="Accounting Period (e.g. 2024–2025)" />
      <button type="submit">Update Profile</button>
    </form>
  </section>

  <section id="income" class="section tab-content">
    <h2>Record Income</h2>
    <form id="incomeForm">
      <input type="date" id="incomeDate" required />
      <input type="number" id="incomeAmount" placeholder="Gross Amount (£)" required />
      <label class="checkbox-label">Includes VAT?<input type="checkbox" id="incomeVAT" /></label>
      <select id="incomeCategory">
        <option>Consulting</option>
        <option>Sales</option>
        <option>Freelance</option>
        <option>Interest</option>
        <option>Other</option>
      </select>
      <input type="text" id="incomeDescription" placeholder="Description" />
      <button type="submit">Add Income</button>
    </form>
    <table id="incomeTable">
      <tr><th>Date</th><th>Net (£)</th><th>VAT (£)</th><th>Category</th><th>Description</th></tr>
    </table>
  </section>

  <section id="expenses" class="section tab-content">
    <h2>Record Expense</h2>
    <form id="expenseForm">
      <input type="date" id="expenseDate" required />
      <input type="number" id="expenseAmount" placeholder="Gross Amount (£)" required />
      <label class="checkbox-label"><input type="checkbox" id="expenseVAT" /> Includes VAT</label>
      <select id="expenseCategory">
        <option>Travel</option>
        <option>Equipment</option>
        <option>Office Supplies</option>
        <option>Utilities</option>
        <option>Marketing</option>
        <option>Professional Fees</option>
        <option>Other</option>
      </select>
      <input type="text" id="expenseDescription" placeholder="Description" />
      <button type="submit">Add Expense</button>
    </form>
    <table id="expenseTable">
      <tr><th>Date</th><th>Net (£)</th><th>VAT (£)</th><th>Category</th><th>Description</th></tr>
    </table>
  </section>

  <section id="summary" class="section tab-content">
    <h2>Summary</h2>
    <label>Select Quarter:
      <select id="quarterSelect">
        <option value="1">Q1 (6 Apr – 5 Jul)</option>
        <option value="2">Q2 (6 Apr – 5 Oct)</option>
        <option value="3">Q3 (6 Apr – 5 Jan)</option>
        <option value="4">Q4 (6 Apr – 5 Apr)</option>
      </select>
    </label>
    <div class="summary">
      Total Income: £<span id="totalIncome">0</span><br>
      Total Expenses: £<span id="totalExpenses">0</span><br>
      Net Total: £<span id="netTotal">0</span>
    </div>
  </section>

  <script>
    const incomeForm = document.getElementById('incomeForm');
    const expenseForm = document.getElementById('expenseForm');
    const incomeTable = document.getElementById('incomeTable');
    const expenseTable = document.getElementById('expenseTable');
    const totalIncomeEl = document.getElementById('totalIncome');
    const totalExpensesEl = document.getElementById('totalExpenses');
    const netTotalEl = document.getElementById('netTotal');
    const darkModeToggle = document.getElementById('darkModeToggle');
    const profileForm = document.getElementById('profileForm');
    const quarterSelect = document.getElementById('quarterSelect');

    let records = { income: [], expenses: [] };
    let vatRate = 20;

    function showTab(tabId) {
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(section => section.classList.remove('active'));
      document.querySelector(`.tab[onclick="showTab('${tabId}')"]`).classList.add('active');
      document.getElementById(tabId).classList.add('active');
    }

    function addRecord(type, date, gross, hasVAT, category, desc) {
      const rate = vatRate / 100;
      const vat = hasVAT ? (gross - gross / (1 + rate)) : 0;
      const net = gross - vat;
      records[type].push({ date, gross, net, vat, category, desc });
    }

    function renderTable(type) {
      const table = type === 'income' ? incomeTable : expenseTable;
      const rows = table.querySelectorAll('tr:not(:first-child)');
      rows.forEach(r => r.remove());
      records[type].forEach(r => {
        const row = table.insertRow();
        row.innerHTML = `<td>${r.date}</td><td>£${r.net.toFixed(2)}</td><td>£${r.vat.toFixed(2)}</td><td>${r.category}</td><td>${r.desc}</td>`;
      });
    }

    function updateSummary() {
      const startYear = 2025; // Adjust for current year if needed
      const cutoffDates = [
        new Date(`${startYear}-07-06`),
        new Date(`${startYear}-10-06`),
        new Date(`${startYear+1}-01-06`),
        new Date(`${startYear+1}-04-06`)
      ];
      const upTo = cutoffDates[parseInt(quarterSelect.value)-1];
      const totalIncome = records.income.filter(r => new Date(r.date) < upTo).reduce((sum,r)=>sum+r.net,0);
      const totalExpenses = records.expenses.filter(r => new Date(r.date) < upTo).reduce((sum,r)=>sum+r.net,0);
      totalIncomeEl.textContent = totalIncome.toFixed(2);
      totalExpensesEl.textContent = totalExpenses.toFixed(2);
      netTotalEl.textContent = (totalIncome - totalExpenses).toFixed(2);
    }

    incomeForm.addEventListener('submit', e=>{
      e.preventDefault();
      addRecord('income', incomeDate.value, parseFloat(incomeAmount.value), incomeVAT.checked, incomeCategory.value, incomeDescription.value);
      renderTable('income'); updateSummary(); incomeForm.reset();
    });

    expenseForm.addEventListener('submit', e=>{
      e.preventDefault();
      addRecord('expenses', expenseDate.value, parseFloat(expenseAmount.value), expenseVAT.checked, expenseCategory.value, expenseDescription.value);
      renderTable('expenses'); updateSummary(); expenseForm.reset();
    });

    profileForm.addEventListener('submit', e=>{
      e.preventDefault();
      document.getElementById('displayName').textContent = businessName.value || 'Not set';
      document.getElementById('displayVAT').textContent = vatNumber.value || 'Not set';
      vatRate = parseFloat(document.getElementById('vatRate').value) || 20;
      document.getElementById('displayVATRate').textContent = vatRate + '%';
      document.getElementById('displayType').textContent = businessType.value || 'Not set';
      document.getElementById('displayBasis').textContent = accountingBasis.value || 'Not set';
      document.getElementById('displayPeriod').textContent = accountingPeriod.value || 'Not set';
      profileForm.reset();
    });

    quarterSelect.addEventListener('change', updateSummary);

    const icon = darkModeToggle.querySelector('i');
    darkModeToggle.addEventListener('click', () => {
      document.body.classList.toggle('dark-mode');
      icon.classList.toggle('fa-sun');
      icon.classList.toggle('fa-moon');
    });
  </script>
</body>
</html>